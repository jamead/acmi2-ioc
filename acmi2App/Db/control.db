#############################################################
#
#       ACMI Database for pscDrv IOC
#      
#
#############################################################

# Flush reg to socket buffer, trigger send to send all socket buffer to PSC 
record(bo, "$(P){ACMI:$(NO)}send") { 
    field(DTYP, "PSC Ctrl Send All") 
    field(OUT , "@PSC$(NO)") 
    field(ZNAM, "Send") 
    field(ONAM, "Send") 
} 
 
# Write a single register
record(longout, "$(P){ACMI:$(NO)}GoRegSingleWrite") {
    field(DTYP, "PSC Ctrl Send")
    field(OUT , "@PSC$(NO)")
    field(VAL , "1") 
    field(FLNK, "$(P){ACMI:$(NO)}send")
}

# Write a single register
record(longout, "$(P){ACMI:$(NO)}GoRegSingleWrite2") {
    field(DTYP, "PSC Ctrl Send")
    field(OUT , "@PSC$(NO)")
    field(VAL , "2") 
    field(FLNK, "$(P){ACMI:$(NO)}send")
}

# Write a single register
record(longout, "$(P){ACMI:$(NO)}GoRegSingleWrite5") {
    field(DTYP, "PSC Ctrl Send")
    field(OUT , "@PSC$(NO)")
    field(VAL , "5") 
    field(FLNK, "$(P){ACMI:$(NO)}send")
}


############# Control PV's ##########################################

record(bo, "$(P){ACMI:$(NO)}KeepAlive-SP") {
    field(DESC, "Keeps the socket active")
    field(DTYP, "PSC Single U32")
    field(OUT , "@PSC$(NO) 5 100")
    field(SCAN, "1 second")
    field(FLNK, "$(P){ACMI:$(NO)}GoRegSingleWrite5")
}

# Triggered by EVR now, this is no longer supported
#record(bo, "$(P){ACMI:$(NO)}Trig:Strig-SP") {
#    field(DESC, "Soft Trigger by user")
#    field(DTYP, "PSC Single U32")
#    field(OUT , "@PSC$(NO) 1 50")
#    field(SCAN, "1 second")   
#    field(FLNK, "$(P){ACMI:$(NO)}GoRegSingleWrite")
#}

record(bo, "$(P){ACMI:$(NO)}Trig:TrigSrc-SP") {
    field(DESC, "Trigger source")
    field(DTYP, "PSC Single U32")
    field(OUT , "@PSC$(NO) 1 52")
    field(ZNAM,"EXT")
    field(ONAM,"INT")
    info(autosaveFields, "VAL")
    field(FLNK, "$(P){ACMI:$(NO)}GoRegSingleWrite")
}

record(longout, "$(P){ACMI:$(NO)}EVR:TrigNo-SP") {
    field(DESC, "EVR Trigger Number")
    field(DTYP, "PSC Single I32")
    field(OUT , "@PSC$(NO) 1 0")
    info(autosaveFields, "VAL")
    field(FLNK, "$(P){ACMI:$(NO)}GoRegSingleWrite")
}

record(longout, "$(P){ACMI:$(NO)}EVR:TrigDly-SP") {
    field(DESC, "EVR Trigger Delay")
    field(DTYP, "PSC Single I32")
    field(OUT , "@PSC$(NO) 1 4")
    info(autosaveFields, "VAL")
    field(FLNK, "$(P){ACMI:$(NO)}GoRegSingleWrite")
}

record(ai,"$(P){ACMI:$(NO)}TS-S-I") {
    field(DESC, "EVR Timestamp (s)")
    field(DTYP, "PSC Reg")
    field(INP , "@PSC$(NO) 55 0 ")
    field(SCAN, "I/O Intr")
}

record(ai,"$(P){ACMI:$(NO)}TS-NS-I") {
    field(DESC, "EVR Timestamp (ns)")
    field(DTYP, "PSC Reg")
    field(INP , "@PSC$(NO) 55 4 ")
    field(SCAN, "I/O Intr")
}

record(waveform,"$(P){ACMI:$(NO)}Trig:Date-I"){
  field(DTYP,"Soft Channel")
  field(DESC,"String for Trigger Date")
  field(NELM,"40")
  field(FTVL,"CHAR")
}

record(waveform,"$(P){ACMI:$(NO)}Settings:File-SP"){
  field(DTYP,"Soft Channel")
  field(DESC,"String for Trigger Date")
  field(NELM,"128")
  field(FTVL,"CHAR")
}

record(longout,"$(P){ACMI:$(NO)}File:Status-I") {
  field(DTYP,"Soft Channel")
  field(VAL,0)
  field(UDF,0)
}

